+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
| state\event                         | online    | offline      | block                 | card                 | number                              | escape                              | enter               | play      | yin tick                             | yang tick                            | timeout             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 1 := number                  |                                     |                     |           |                                      |                                      |                     |
|                                     | clear led | show offline | block countdown := 10 | play offline         | token input countdown := 30         |                                     |                     |           |                                      |                                      |                     |
|                                     | ----      | ----         | ----                  | ----                 | ----                                |                                     |                     |           |                                      |                                      |                     |
| OFFLINE                             | STANDBY   | OFFLINE      | BLOCKED               | OFFLINE              | TOKEN NUMBER 1 INPUTED WHEN OFFLINE |                                     |                     |           |                                      |                                      |                     |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       | save card            | number 1 := number                  |                                     |                     |           |                                      |                                      |                     |
|                                     |           | show offline | block countdown := 10 | card countdown := 30 | token input countdown := 30         |                                     |                     |           |                                      |                                      |                     |
|                                     |           | ----         | ----                  | ----                 | ----                                |                                     |                     |           |                                      |                                      |                     |
| STANDBY                             |           | OFFLINE      | BLOCKED               | CARD READ            | TOKEN NUMBER 1 INPUTED WHEN STANDBY |                                     |                     |           |                                      |                                      |                     |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | clear led                           |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | token input countdown := 30         |                                     |                     | clear led |                                      |                                      | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                |                                     |                     | ----      | show request timer                   | show request timer                   | ----                |
| REQUESTING                          |           |              | BLOCKED               | CARD READ            | TOKEN NUMBER 1 INPUTED WHEN OFFLINE |                                     |                     | OFFLINE   | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      |                                     |                                     |                     |           | decrease block countdown             | decrease block countdown             | clear led           |
|                                     |           |              |                       |                      |                                     |                                     |                     |           | show block countdown                 | show block countdown                 | ----                |
| BLOCKED                             |           |              |                       |                      |                                     |                                     |                     |           | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       | save card            | number 1 := number                  |                                     | card lock off       |           | decrease card countdown              | decrease card countdown              |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | play audio                          | clear led                           | start request timer |           | show card countdown                  | show card countdown                  | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                | ----                |           | clear cursor                         | show cursor                          | ----                |
| CARD READ                           |           |              | BLOCKED               | CARD READ            | CARD NUMBER 1 INPUTED               | STANDBY                             | REQUESTING          |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 2 := number 1                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  |                                     | card lock off       |           | decrease card countdown              | decrease card countdown              |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | play audio                          | number 1 := 0                       | start request timer |           | show card countdown                  | show card countdown                  | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                | ----                |           | clear cursor                         | show cursor                          | ----                |
| CARD NUMBER 1 INPUTED               |           |              | BLOCKED               | CARD READ            | CARD NUMBER 2 INPUTED               | CARD READ                           | REQUESTING          |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 3 := number 2                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  | number 2 := 0                       | card lock off       |           | decrease card countdown              | decrease card countdown              |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | play audio                          |                                     | start request timer |           | show card countdown                  | show card countdown                  | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                | ----                |           | clear cursor                         | show cursor                          | ----                |
| CARD NUMBER 2 INPUTED               |           |              | BLOCKED               | CARD READ            | CARD NUMBER 3 INPUTED               | CARD NUMBER 1 INPUTED               | REQUESTING          |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 4 := number 3                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  | number 3 := 0                       | card lock off       |           | decrease card countdown              | decrease card countdown              |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | play audio                          |                                     | start request timer |           | show card countdown                  | show card countdown                  | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                | ----                |           | clear cursor                         | show cursor                          | ----                |
| CARD NUMBER 3 INPUTED               |           |              | BLOCKED               | CARD READ            | CARD NUMBER 4 INPUTED               | CARD NUMBER 2 INPUTED               | REQUESTING          |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      |                                     | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      |                                     | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      |                                     | number 3 := number 4                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            |                                     | number 4 := 0                       | card lock off       |           | decrease card countdown              | decrease card countdown              |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 |                                     |                                     | start request timer |           | show card countdown                  | show card countdown                  | clear led           |
|                                     |           |              | ----                  | ----                 |                                     | ----                                | ----                |           | clear cursor                         | show cursor                          | ----                |
| CARD NUMBER 4 INPUTED               |           |              | BLOCKED               | CARD READ            |                                     | CARD NUMBER 3 INPUTED               | REQUESTING          |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 2 := number 1                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 1 := number                  | number 1 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 |                      | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  |                      | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 1 INPUTED WHEN OFFLINE |           |              | BLOCKED               |                      | TOKEN NUMBER 2 INPUTED WHEN OFFLINE | OFFLINE                             |                     |           | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 3 := number 2                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 1 := number                  | number 2 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 |                      | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  |                      | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 2 INPUTED WHEN OFFLINE |           |              | BLOCKED               |                      | TOKEN NUMBER 3 INPUTED WHEN OFFLINE | TOKEN NUMBER 1 INPUTED WHEN OFFLINE |                     |           | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 4 := number 3                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 1 := number                  | number 3 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 |                      | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  |                      | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 3 INPUTED WHEN OFFLINE |           |              | BLOCKED               |                      | TOKEN NUMBER 4 INPUTED WHEN OFFLINE | TOKEN NUMBER 2 INPUTED WHEN OFFLINE |                     |           | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 5 := number 4                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 4 := number 3                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 3 := number 4                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 1 := number                  | number 4 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 |                      | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  |                      | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 4 INPUTED WHEN OFFLINE |           |              | BLOCKED               |                      | TOKEN NUMBER 5 INPUTED WHEN OFFLINE | TOKEN NUMBER 3 INPUTED WHEN OFFLINE |                     |           | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 6 := number 5                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 5 := number 4                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 4 := number 3                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 1 := number                  | number 3 := number 4                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | token input countdown := 0          | number 4 := number 5                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | token lock off                      | number 5 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 |                      | token locking off countdown := 5    | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  |                      | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 5 INPUTED WHEN OFFLINE |           |              | BLOCKED               |                      | TOKEN LOCKING OFF WHEN OFFLINE      | TOKEN NUMBER 4 INPUTED WHEN OFFLINE |                     |           | ----                                 | ----                                 | OFFLINE             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      |                                     |                                     |                     |           |                                      |                                      | clear led           |
|                                     |           |              | block countdown := 10 |                      |                                     |                                     |                     | clear led |                                      |                                      | start request timer |
|                                     |           |              | ----                  |                      |                                     |                                     |                     | ----      | decrease token locking off countdown | decrease token locking off countdown | ----                |
| TOKEN LOCKING OFF WHEN OFFLINE      |           |              | BLOCKED               |                      |                                     |                                     |                     | OFFLINE   | ----                                 | ----                                 | REQUESTING          |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 2 := number 1                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  | number 1 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 1 INPUTED WHEN STANDBY |           |              | BLOCKED               | CARD READ            | TOKEN NUMBER 2 INPUTED WHEN STANDBY | STANDBY                             |                     |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 3 := number 2                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  | number 2 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 2 INPUTED WHEN STANDBY |           |              | BLOCKED               | CARD READ            | TOKEN NUMBER 3 INPUTED WHEN STANDBY | TOKEN NUMBER 1 INPUTED WHEN STANDBY |                     |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 4 := number 3                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  | number 3 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 3 INPUTED WHEN STANDBY |           |              | BLOCKED               | CARD READ            | TOKEN NUMBER 4 INPUTED WHEN STANDBY | TOKEN NUMBER 2 INPUTED WHEN STANDBY |                     |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 5 := number 4                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 4 := number 3                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 3 := number 4                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | number 1 := number                  | number 4 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | token input countdown := 30         | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 4 INPUTED WHEN STANDBY |           |              | BLOCKED               | CARD READ            | TOKEN NUMBER 5 INPUTED WHEN STANDBY | TOKEN NUMBER 3 INPUTED WHEN STANDBY |                     |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      | number 6 := number 5                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 5 := number 4                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 4 := number 3                |                                     |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 3 := number 2                | number 1 := number 2                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 2 := number 1                | number 2 := number 3                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | number 1 := number                  | number 3 := number 4                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       |                      | token input countdown := 0          | number 4 := number 5                |                     |           |                                      |                                      |                     |
|                                     |           |              |                       | save card            | token lock off                      | number 5 := 0                       |                     |           |                                      |                                      |                     |
|                                     |           |              | block countdown := 10 | card countdown := 30 | token locking off countdown := 5    | token input countdown := 30         |                     |           |                                      |                                      | clear led           |
|                                     |           |              | ----                  | ----                 | ----                                | ----                                |                     |           | decrease token input countdown       | decrease token input countdown       | ----                |
| TOKEN NUMBER 5 INPUTED WHEN STANDBY |           |              | BLOCKED               | CARD READ            | TOKEN LOCKING OFF WHEN STANDBY      | TOKEN NUMBER 4 INPUTED WHEN STANDBY |                     |           | ----                                 | ----                                 | STANDBY             |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
|                                     |           |              |                       |                      |                                     |                                     |                     |           |                                      |                                      | clear led           |
|                                     |           |              | block countdown := 10 |                      |                                     |                                     |                     | clear led |                                      |                                      | start request timer |
|                                     |           |              | ----                  |                      |                                     |                                     |                     | ----      | decrease token locking off countdown | decrease token locking off countdown | ----                |
| TOKEN LOCKING OFF WHEN STANDBY      |           |              | BLOCKED               |                      |                                     |                                     |                     | STANDBY   | ----                                 | ----                                 | REQUESTING          |
+-------------------------------------+-----------+--------------+-----------------------+----------------------+-------------------------------------+-------------------------------------+---------------------+-----------+--------------------------------------+--------------------------------------+---------------------+
